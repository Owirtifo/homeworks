## Домашнее задание к занятию "10.6. Инцидент-менеджмент"

Постмотрем, на основе реального сбоя системы Github в 2018 году:

| Раздел        | Сбой системы GitHub 21 октября 2018                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
|:--------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------| 
| Краткое описание инцидента | После потери связи между сетевым хабом на восточном побережье США и датацентром на восточном побережье США на 43 секунды изменалсь топология кластеров MySQL под управлением Orchestrator, что привело к несогласованности данных между кластерами БД основного датацентра на восточном побережье США и кластерами БД датацентра на западном побережье США.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| Предшествующие события | Плановые работы по замене вышедшего из строя 100G оптического оборудования в датацентре на восточном побережье США                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| Причина инцидента | Потеря связи между сетевым хабом на восточном побережье США и датацентром на восточном побережье США                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
| Воздействие | Отображение устаревшей и непоследовательной информации. Также в большинстве случаев не функционировали события WebHooks и сборка и публикация GitHub Pages                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| Обнаружение | Инцидент был замечен дежурными инженерами через оповещения системы мониторинга                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| Реакция | Группа реагирования на инциденты провела восстановительные работы сервиса за 24 часа 11 минут                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Восстановление | Для предотвращения потери данных временно отключили часть сервисов (Webhook delivery и GitHub Pages builds) для обеспечения целостности данных, после чего выполненили восстановление данные на восточном побережье США из резервных копий и реплицировали новые данные с на западного побережья США. Для уменьшения задержки репликации данных были выделены дополнительные реплики MySQL в общедоступном облаке восточного побережья США. После окончания синхронизации выполнели переход на исходную топологию и включили деактивированный функционал. Завершающим этапом стало отработка накопленных событий webhooks и Pages сборок.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| Таймлайн | **21 октября 2018, 22:52 UTC** - потеря связи между сетевым хабом на восточном побережье США и датацентром на восточном побережье США на 43 секунды привела к изменению топологии кластеров MySQL под управлением Orchestrator. В следствие чего основым стал кластер на западном побережье США. Поскольку серверы баз данных в центре обработки данных на восточном побережье США содержали короткий период записи, который не был реплицирован в БД на западном побережье США, стало невозможно выполнить возврат основного кластера на восточном побережье США.<br>**21 октября 2018, 22:54 UTC** - Внутренние системы мониторинга начали генерировать оповещения о многочисленных сбоях в работе систем<br> **21 октября 2018, 23:02 UTC** - Инженеры первой группы реагирования определили, что топологии для многочисленных кластеров БД находятся в неожиданном состоянии - при запросе API Оркестратора отображалась топология репликации БД, содержащая только серверы из западного ЦОД.<br> **21 октября 2018, 23:07 UTC** - Группа реагирования вручную заблокировала внутренние средства развёртывания, чтобы предотвратить внесение дополнительных изменений в БД<br> **21 октября 2018, 23:09 UTC** - Группа реагирования установила жёлтый статус работоспособности сайта (статус активного инцидента)<br> **21 октября 2018, 23:11 UTC** - Координатор присоединился к работе и через две минуты принял решение изменить статус сайта на красный.<Br> **21 октября 2018, 23:13 UTC** - К работе привлекли дополнительных разработчиков из инженерной группы БД, которые начали исследовать текущее состояние для определения необходимых действий для ручной перенастроийки БД<br> **21 октября 2018, 23:19 UTC** - Из-за задержки, возникающей из-за обмена данными между кластерами, в целях сохранности данных принято решение об остановке доставки WebHooks и сборки и публикации GitHub Pages<br> **22 октября 2018, 00:05 UTC** - Инженеры из группы реагирования начали разрабатывать план по устранению несогласованности данных и внедрению процедур для аварийного переключения на исходную топологию. Обновили наш статус, чтобы проинформировать пользователей о том, что мы собираемся выполнить контролируемый переход на другой ресурс внутренней системы хранения данных.<br> **22 октября 2018, 00:41 UTC** - Инициирован процесс резервного копирования для всех затронутых кластеров MySQL. Одновременно несколько групп инженеров изучали способы ускорения передачи и восстановления данных без дальнейшей деградации сайта или риска повреждения данных<br> **22 октября 2018, 06:51 UTC** - Несколько кластеров на восточном побережье США завершили восстановление из резервных копий и начали реплицировать новые данные с Западным побережьем. Другие более крупные кластеры баз данных все еще восстанавливались.<br> **22 октября 2018, 07:46 UTC** - Публикация информационного сообщение об инциденте<br> **22 октября 2018, 11:12 UTC** - Все первичные БД стали вновь установлены на восточном побережье США, но не смотря на то, что производительность сайта выросла, десятки реплик чтения базы данных, которые отставали от основной на несколько часов. Эти отложенные реплики приводили к тому, что пользователи видели несогласованные данные при взаимодействии с нашими службами.<br> **22 октября 2018, 13:15 UTC** - Зафиксировано возрастание отставания репликации до согласованного состояния (время увеличивалось, а не уменьшалось). Начали предоставлять дополнительные реплики чтения MySQL в общедоступном облаке восточного побережья США, для ускорения репликации<br> **22 октября 2018, 16:24 UTC** - Завершена синхронизация реплик. Выполнен возврат к исходной топологии. Устранинены проблемы задержки и доступности. Однако, красный статус был сохранён, так как были накопленные данные, которые нужно было обработать.<br> **22 октяюря 2018, 16:45 UTC** - На этапе восстановления в очереди было более пяти миллионов hook-событий и 80 тысяч сборок страниц. Мы оставались в деградированном статусе до тех пор, пока не завершили обработку всего отставания данных и не убедились, что наши сервисы явно вернулись к нормальному уровню производительности.<br> **22 октября 2018, 23:03 UTC** - Все незавершённые события webhook и сборки Pages обработаны и была подтверждена целостность и правильная работа всех систем. Статус сайта изменён на зелёный. |
| Последующие действия | Перенастроили конфигурацию Orchestrator, чтобы запретить перемещение первичных БД за границы региона.<br>Ускорили переход на новый механизм отчетов о состоянии, который предоставит нам более богатый форум для обсуждения активных инцидентов более четким и понятным языком.<br/>Запустили проект для поддержки обслуживания трафика GitHub из нескольких ЦОД по архитектуре active/active/active. Цель данного проекта — допустить полный отказ одного центра обработки данных без влияния на пользователя.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
